import{u as D,r as n,a as M,d as y,j as e,H as W,b as $}from"./app-CAs3FYUA.js";import{A as q,b as G}from"./alert-CbPNizC_.js";import{C as g,a as u,b as h,c as N,d as x}from"./card-kTSxZJUv.js";import{L as m}from"./label-CnlSRV7R.js";import{A as J}from"./app-layout-BiJ-zR9e.js";import{r as S}from"./image-compression-C1UeteK-.js";import{CategorySelect as K}from"./CategorySelect-BD1iJPoK.js";import{ContentEditor as Q}from"./ContentEditor-B62hWJWx.js";import{ExcerptInput as V}from"./ExcerptInput-K7RKtA-G.js";import{FeaturedToggle as X}from"./FeaturedToggle-DqKtVoWC.js";import{FormActions as Y}from"./FormActions-CwWK-sP_.js";import{FormHeader as Z}from"./FormHeader-DuoIjkao.js";import{PublishDateInput as ee}from"./PublishDateInput-DSq13d1r.js";import{StatusSelect as te}from"./StatusSelect-Cb9RS_WG.js";import{SubCategorySelect as se}from"./SubCategorySelect-aQUMyWEU.js";import{TagsInput as re}from"./TagsInput-CxIrte34.js";import{ThumbnailUpload as ae}from"./ThumbnailUpload-DsBXq2Sx.js";import{TitleSlugInput as ie}from"./TitleSlugInput-CPhSVbVN.js";import{UrlExtractor as oe}from"./UrlExtractor-lP2oMKJg.js";import{C as ne}from"./circle-check-DBgV__GK.js";/* empty css            */import"./button-ChbGwhfT.js";import"./index-DJzZURwb.js";import"./utils-D0Zg16Wk.js";import"./index-DLjb_Cay.js";import"./sheet-Be-fUba5.js";import"./createLucideIcon-BlGQPA8D.js";import"./index-CWrTy9At.js";import"./Combination-BfOU9iUi.js";import"./index-BezftZ-f.js";import"./x-J0sVX2kd.js";import"./index-SSEEGKc_.js";import"./index-Cgip5RDl.js";import"./index-DaccTv86.js";import"./dropdown-menu-zDAkMsYp.js";import"./index-DSOkqTVi.js";import"./index-CMWG4mbA.js";import"./app-logo-icon-BSq30Swh.js";import"./input-BZTwSrx5.js";import"./select-BafAaR5D.js";import"./index-Dl78vKZG.js";import"./check-CArGZkSs.js";import"./plus-B2mScTvl.js";import"./textarea-C7W4NNGC.js";import"./switch-25lgUMZn.js";import"./index-DGdR22o3.js";import"./loader-circle-DoGaVxWB.js";import"./chevron-left-CZt1OvuH.js";import"./badge-BSqbxF8A.js";import"./image-Bbx7-s-T.js";import"./circle-alert-Cajd0Ayh.js";function pt(){const{props:v}=D(),{categories:T=[],sub_categories:E=[],tags:F=[],post:o=null,flash:_={}}=v||{},l=!!o,C=n.useRef(null),[L,p]=n.useState(o?.thumbnail_url||null),[k,U]=n.useState(typeof window<"u"&&window.innerWidth<1024),[A,le]=n.useState(()=>typeof document<"u"&&document.documentElement.classList.contains("dark")),[ce,de]=n.useState(""),[me,pe]=n.useState(null),[ge,ue]=n.useState(!1),{data:r,setData:s,processing:w,errors:c}=M({category_id:o?.category_id||null,category_name:"",sub_category_id:o?.sub_category_id||null,title:o?.title||"",slug:o?.slug||"",excerpt:o?.excerpt||"",content:o?.content||"",status:o?.status||"published",is_featured:o?.is_featured||!1,thumbnail:null,tags:o?.tags.map(t=>t.name)||[],published_at:o?.published_at||(o?null:new Date().toISOString().split("T")[0])});n.useCallback(async t=>{try{const i=(await y.get(t,{responseType:"blob",headers:{Accept:"image/*"}})).data,d=t.split("/").pop()?.split("?")[0]||"thumbnail.jpg",f=new File([i],d,{type:i.type||"image/jpeg"}),j=URL.createObjectURL(i);p(j),s("thumbnail",f)}catch(a){console.error("Error fetching thumbnail:",a),p(t)}},[s]);const b=n.useCallback(t=>{s("title",t),l||s("slug",t.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,""))},[s,l]),P=n.useCallback(async t=>{const a=t.target.files?.[0];if(a)try{const i=await S(a,1200,800),d=new File([i],a.name,{type:a.type});p(URL.createObjectURL(d)),s("thumbnail",d)}catch(i){console.error("Failed to resize thumbnail:",i)}},[s]),R=n.useCallback(t=>{const a=t.toLowerCase().trim();a&&!r.tags.includes(a)&&s("tags",[...r.tags,a])},[r.tags,s]),z=n.useCallback(t=>{s("tags",r.tags.filter(a=>a!==t))},[r.tags,s]),I=n.useCallback(async t=>{if(t.title&&b(t.title),t.content&&s("content",t.content),t.thumbnail)try{const i=(await y.get(t.thumbnail,{responseType:"blob",headers:{Accept:"image/*"}})).data,d=t.thumbnail.split("/").pop()?.split("?")[0]||"thumbnail.jpg",f=new File([i],d,{type:i.type||"image/jpeg"}),j=URL.createObjectURL(i);p(j),s("thumbnail",f)}catch(a){console.error("Failed to fetch thumbnail:",a),p(t.thumbnail)}if(t.tags&&Array.isArray(t.tags)){const a=t.tags.map(i=>i.toLowerCase().trim()).filter(i=>i&&!r.tags.includes(i));a.length>0&&s("tags",[...r.tags,...a])}},[b,s,r.tags]),O=n.useCallback(async t=>{try{const a=await S(t.blob(),1200,800),i=new FormData;i.append("image",a,t.filename()),l&&o?.id&&i.append("news_id",o.id.toString());const{data:d}=await y.post("/dashboard/posts/upload-image",i);return d.url}catch{throw new Error("Upload failed")}},[l,o?.id]),H=t=>{t.preventDefault();const a=C.current?.getContent()||r.content;$.post(l?`/dashboard/posts/${o?.id}`:"/dashboard/posts",{...r,content:a,_method:l?"PUT":"POST"},{forceFormData:!0})};n.useEffect(()=>{const t=()=>U(window.innerWidth<1024);return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]);const B=[{title:"Dashboard",href:"/dashboard"},{title:"Posts",href:"/dashboard/posts"},{title:l?"Edit":"Create",href:"#"}];return e.jsxs(J,{breadcrumbs:B,children:[e.jsx(W,{title:`${l?"Edit":"Create"} Post`}),e.jsxs("form",{onSubmit:H,className:"mx-auto max-w-[98%] space-y-4 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Z,{isEdit:l}),e.jsx(Y,{isEdit:l,processing:w})]}),_?.success&&e.jsxs(q,{className:"border-green-500/50 bg-green-500/5",children:[e.jsx(ne,{className:"h-4 w-4 text-green-600"}),e.jsx(G,{className:"text-green-600",children:_.success})]}),!l&&e.jsx(oe,{onExtractSuccess:I,isLoading:w}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-12",children:[e.jsxs("div",{className:"space-y-6 lg:col-span-9",children:[e.jsxs(g,{children:[e.jsxs(u,{className:"space-y-1",children:[e.jsx(h,{className:"text-lg",children:"Content"}),e.jsx(N,{children:"Write your post title and body here."})]}),e.jsxs(x,{className:"grid gap-6",children:[e.jsx(ie,{title:r.title,slug:r.slug,isEdit:l,onTitleChange:b,onSlugChange:t=>s("slug",t),errors:c}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{className:"text-sm font-semibold",children:"Body Content"}),e.jsx(Q,{ref:C,value:r.content,onChange:t=>s("content",t),imageHandler:O,useDarkMode:A,isSmallScreen:k,error:c.content})]})]})]}),e.jsxs(g,{children:[e.jsxs(u,{className:"space-y-1",children:[e.jsx(h,{className:"text-lg",children:"Summary"}),e.jsx(N,{children:"Brief summary for SEO. If left empty, it will be generated from content."})]}),e.jsx(x,{className:"grid gap-2",children:e.jsx(V,{value:r.excerpt,onChange:t=>s("excerpt",t),error:c.excerpt})})]})]}),e.jsxs("div",{className:"space-y-6 lg:col-span-3",children:[e.jsxs(g,{children:[e.jsx(u,{className:"space-y-1",children:e.jsx(h,{className:"text-base",children:"Publishing"})}),e.jsxs(x,{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{className:"text-xs tracking-wider text-muted-foreground uppercase",children:"Post Status"}),e.jsx(te,{value:r.status,onChange:t=>s("status",t),error:c.status})]}),r.status==="published"&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{className:"text-xs tracking-wider text-muted-foreground uppercase",children:"Publish Date"}),e.jsx(ee,{value:r.published_at,onChange:t=>s("published_at",t),error:c.published_at})]}),e.jsx(X,{value:r.is_featured,onChange:t=>s("is_featured",t)})]})]}),e.jsxs(g,{children:[e.jsx(u,{className:"space-y-1",children:e.jsx(h,{className:"text-base",children:"Organization"})}),e.jsxs(x,{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{className:"text-xs tracking-wider text-muted-foreground uppercase",children:"Category"}),e.jsx(K,{categories:T,value:r.category_id?String(r.category_id):"",onChange:t=>{s("category_id",parseInt(t)),s("category_name",""),s("sub_category_id",null)},onCreateCategory:t=>{s("category_id",null),s("category_name",t),s("sub_category_id",null)},error:c.category_id||c.category_name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{className:"text-xs tracking-wider text-muted-foreground uppercase",children:"Sub Category"}),e.jsx(se,{subCategories:E,categoryId:r.category_id||0,value:r.sub_category_id,onChange:t=>s("sub_category_id",t?parseInt(t):null),error:c.sub_category_id})]})]})]}),e.jsxs(g,{children:[e.jsx(u,{className:"space-y-1",children:e.jsx(h,{className:"text-base",children:"Media & Tags"})}),e.jsxs(x,{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{className:"text-center text-xs tracking-wider text-muted-foreground uppercase",children:"Thumbnail"}),e.jsx(ae,{previewUrl:L,onChange:P,error:c.thumbnail})]}),e.jsxs("div",{className:"grid gap-2 border-t pt-4",children:[e.jsx(m,{className:"text-xs tracking-wider text-muted-foreground uppercase",children:"Post Tags"}),e.jsx(re,{tags:r.tags,availableTags:F,onAddTag:R,onRemoveTag:z,error:c.tags})]})]})]})]})]})]})]})}export{pt as default};

import{u as D,r as l,a as M,d as C,j as e,H as W,b as $}from"./app-BAmpkNjy.js";import{A as q,b as G}from"./alert-BU5Ozf2f.js";import{C as p,a as g,b as u,c as _,d as h}from"./card-DpENV9Wt.js";import{L as d}from"./label-iT89wgoS.js";import{A as J}from"./app-layout-oOGWrkbs.js";import{r as w}from"./image-compression-C1UeteK-.js";import{CategorySelect as K}from"./CategorySelect-cwtN4QPh.js";import{ContentEditor as Q}from"./ContentEditor-BtBySGf9.js";import{ExcerptInput as V}from"./ExcerptInput-RfYmO3pT.js";import{FeaturedToggle as X}from"./FeaturedToggle-B8_sw9-i.js";import{FormActions as Y}from"./FormActions-BVli2QM0.js";import{FormHeader as Z}from"./FormHeader-DoHJ_gVE.js";import{PublishDateInput as ee}from"./PublishDateInput-DkV3DFoB.js";import{StatusSelect as se}from"./StatusSelect-DtpiARvp.js";import{SubCategorySelect as te}from"./SubCategorySelect-BQeBawie.js";import{TagsInput as re}from"./TagsInput-Bn_Ua2rQ.js";import{ThumbnailUpload as ae}from"./ThumbnailUpload-tipl7Bk3.js";import{TitleSlugInput as ie}from"./TitleSlugInput-CRSel8Hc.js";import{UrlExtractor as oe}from"./UrlExtractor-rVIu0fdb.js";import{C as ne}from"./circle-check-Ceblt8ia.js";/* empty css            */import"./button-skCR1_Jx.js";import"./index-BY-dejON.js";import"./utils-D0Zg16Wk.js";import"./index-DGU6t1t7.js";import"./sheet-blIQyt7D.js";import"./createLucideIcon-BonU81wA.js";import"./index-CGBFwMly.js";import"./Combination-Do_tasbs.js";import"./index-CHAGuMME.js";import"./x-5ocSDTD-.js";import"./index-BkP9UUpw.js";import"./index-DeAd4XkQ.js";import"./index-Bnf6BrLO.js";import"./dropdown-menu-saMUT3bU.js";import"./index-DSOkqTVi.js";import"./index-CMWG4mbA.js";import"./app-logo-icon-BO4okK4P.js";import"./input-inQaeRuf.js";import"./select-1wKYT5O1.js";import"./index-CnrMX4SY.js";import"./check-q3NGwcj5.js";import"./plus-cVgo6zxW.js";import"./textarea-BLN2MREk.js";import"./switch-aDgvYENe.js";import"./index-DGdR22o3.js";import"./loader-circle-DwUUodBb.js";import"./chevron-left-CCbZXiHz.js";import"./badge-YRyiT1Sv.js";import"./image-m3TEMeLU.js";import"./circle-alert-7Nw0loUS.js";function os(){const{props:N}=D(),{categories:S=[],sub_categories:v=[],tags:T=[],post:i=null,flash:b={}}=N||{},n=!!i,f=l.useRef(null),[k,j]=l.useState(i?.thumbnail_url||null),[E,L]=l.useState(typeof window<"u"&&window.innerWidth<1024),[P,le]=l.useState(()=>typeof document<"u"&&document.documentElement.classList.contains("dark")),{data:r,setData:t,processing:y,errors:c}=M({category_id:i?.category_id||null,category_name:"",sub_category_id:i?.sub_category_id||null,title:i?.title||"",slug:i?.slug||"",excerpt:i?.excerpt||"",content:i?.content||"",status:i?.status||"published",is_featured:i?.is_featured||!1,thumbnail:null,tags:i?.tags.map(s=>s.name)||[],published_at:i?.published_at||(i?null:new Date().toISOString().split("T")[0])}),x=l.useCallback(s=>{t("title",s),n||t("slug",s.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,""))},[t,n]),F=l.useCallback(async s=>{const a=s.target.files?.[0];if(a)try{const o=await w(a,1200,800),m=new File([o],a.name,{type:a.type});j(URL.createObjectURL(m)),t("thumbnail",m)}catch(o){console.error("Failed to resize thumbnail:",o)}},[t]),U=l.useCallback(async s=>{if(s.title&&x(s.title),s.content&&t("content",s.content),s.thumbnail)try{const o=(await C.get(s.thumbnail,{responseType:"blob",headers:{Accept:"image/*"}})).data,m=s.thumbnail.split("/").pop()?.split("?")[0]||"thumbnail.jpg",H=new File([o],m,{type:o.type||"image/jpeg"}),B=URL.createObjectURL(o);j(B),t("thumbnail",H)}catch(a){console.error("Failed to fetch thumbnail:",a)}if(s.tags&&Array.isArray(s.tags)){const a=s.tags.map(o=>o.toLowerCase().trim()).filter(o=>o&&!r.tags.includes(o));a.length>0&&t("tags",[...r.tags,...a])}},[x,t,r.tags]),z=l.useCallback(s=>{const a=s.toLowerCase().trim();a&&!r.tags.includes(a)&&t("tags",[...r.tags,a])},[r.tags,t]),A=l.useCallback(s=>{t("tags",r.tags.filter(a=>a!==s))},[r.tags,t]),I=l.useCallback(async s=>{try{const a=await w(s.blob(),1200,800),o=new FormData;o.append("image",a,s.filename()),n&&i?.id&&o.append("news_id",i.id.toString());const{data:m}=await C.post("/dashboard/posts/upload-image",o);return m.url}catch{throw new Error("Upload failed")}},[n,i?.id]),R=s=>{s.preventDefault();const a=f.current?.getContent()||r.content;$.post(n?`/dashboard/posts/${i?.id}`:"/dashboard/posts",{...r,content:a,_method:n?"PUT":"POST"},{forceFormData:!0})};l.useEffect(()=>{const s=()=>L(window.innerWidth<1024);return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]);const O=[{title:"Dashboard",href:"/dashboard"},{title:"Posts",href:"/dashboard/posts"},{title:n?"Edit":"Create",href:"#"}];return e.jsxs(J,{breadcrumbs:O,children:[e.jsx(W,{title:`${n?"Edit":"Create"} Post`}),e.jsxs("form",{onSubmit:R,className:"mx-auto max-w-[98%] space-y-4 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Z,{isEdit:n}),e.jsx(Y,{isEdit:n,processing:y})]}),b?.success&&e.jsxs(q,{className:"border-green-500/50 bg-green-500/5",children:[e.jsx(ne,{className:"h-4 w-4 text-green-600"}),e.jsx(G,{className:"text-green-600",children:b.success})]}),!n&&e.jsx(oe,{onExtractSuccess:U,isLoading:y}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-12",children:[e.jsxs("div",{className:"space-y-6 lg:col-span-9",children:[e.jsxs(p,{children:[e.jsxs(g,{className:"space-y-1",children:[e.jsx(u,{className:"text-lg",children:"Content"}),e.jsx(_,{children:"Write your post title and body here."})]}),e.jsxs(h,{className:"grid gap-6",children:[e.jsx(ie,{title:r.title,slug:r.slug,isEdit:n,onTitleChange:x,onSlugChange:s=>t("slug",s),errors:c}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{className:"text-sm font-semibold",children:"Body Content"}),e.jsx(Q,{ref:f,value:r.content,onChange:s=>t("content",s),imageHandler:I,useDarkMode:P,isSmallScreen:E,error:c.content})]})]})]}),e.jsxs(p,{children:[e.jsxs(g,{className:"space-y-1",children:[e.jsx(u,{className:"text-lg",children:"Summary"}),e.jsx(_,{children:"Brief summary for SEO. If left empty, it will be generated from content."})]}),e.jsx(h,{className:"grid gap-2",children:e.jsx(V,{value:r.excerpt,onChange:s=>t("excerpt",s),error:c.excerpt})})]})]}),e.jsxs("div",{className:"space-y-6 lg:col-span-3",children:[e.jsxs(p,{children:[e.jsx(g,{className:"space-y-1",children:e.jsx(u,{className:"text-base",children:"Publishing"})}),e.jsxs(h,{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{className:"text-xs tracking-wider text-muted-foreground uppercase",children:"Post Status"}),e.jsx(se,{value:r.status,onChange:s=>t("status",s),error:c.status})]}),r.status==="published"&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{className:"text-xs tracking-wider text-muted-foreground uppercase",children:"Publish Date"}),e.jsx(ee,{value:r.published_at,onChange:s=>t("published_at",s),error:c.published_at})]}),e.jsx(X,{value:r.is_featured,onChange:s=>t("is_featured",s)})]})]}),e.jsxs(p,{children:[e.jsx(g,{className:"space-y-1",children:e.jsx(u,{className:"text-base",children:"Organization"})}),e.jsxs(h,{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{className:"text-xs tracking-wider text-muted-foreground uppercase",children:"Category"}),e.jsx(K,{categories:S,value:r.category_id?String(r.category_id):"",onChange:s=>{t("category_id",parseInt(s)),t("category_name",""),t("sub_category_id",null)},onCreateCategory:s=>{t("category_id",null),t("category_name",s),t("sub_category_id",null)},error:c.category_id||c.category_name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{className:"text-xs tracking-wider text-muted-foreground uppercase",children:"Sub Category"}),e.jsx(te,{subCategories:v,categoryId:r.category_id||0,value:r.sub_category_id,onChange:s=>t("sub_category_id",s?parseInt(s):null),error:c.sub_category_id})]})]})]}),e.jsxs(p,{children:[e.jsx(g,{className:"space-y-1",children:e.jsx(u,{className:"text-base",children:"Media & Tags"})}),e.jsxs(h,{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{className:"text-center text-xs tracking-wider text-muted-foreground uppercase",children:"Thumbnail"}),e.jsx(ae,{previewUrl:k,onChange:F,error:c.thumbnail})]}),e.jsxs("div",{className:"grid gap-2 border-t pt-4",children:[e.jsx(d,{className:"text-xs tracking-wider text-muted-foreground uppercase",children:"Post Tags"}),e.jsx(re,{tags:r.tags,availableTags:T,onAddTag:z,onRemoveTag:A,error:c.tags})]})]})]})]})]})]})]})}export{os as default};
